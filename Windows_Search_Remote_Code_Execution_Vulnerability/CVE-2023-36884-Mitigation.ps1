#CVE-2023-36884 
#Windows Search Remote Code Execution Vulnerability
#EXECUTE AS AN ADMIN!!!

function editProtocol($path){
  Get-ItemProperty -Path $path
  Set-ItemProperty -Path $path -Name '(default)' -Value ''
  Remove-ItemProperty -Path $path -Name 'URL protocol' -ErrorAction SilentlyContinue
}

if(Test-Path 'HKCR:\ms-search'){
 Write-Output "Route founded"
 editProtocol 'HKCR:\ms-search'
}
else{
 Write-Output "Route not founded,creating route..."
 New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT
 editProtocol 'HKCR:\ms-search'
}
